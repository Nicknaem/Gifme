<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
*{
    margin:0;
    padding:0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
header{
    display: flex;
    flex-direction: column;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.2);
}
header > * {
    margin:10px 0px;
}
nav{
    display: flex;
}
.container{
    width: 1200px;
    margin: auto;
}
#gifs-section{
    display: flex;
    flex-wrap: wrap;
}
#gifs-section > div > img{
    height: 200px;
}

.search-bar{
    display: flex;
}

.gif-bar{
    display: flex;
    justify-content: space-between;
}
.emotes-wrapper{
    display: flex;
}
.emotes-wrapper > img{
    height: 20px;
}
@media (max-width: 1300px){
    .container{
        width: 80%;
        overflow: hidden;
    }
}
</style>
<body>
    <header>
        <h1 class="title">Giphy API Example</h1>
        <nav class="nav-tags">
            <!-- contains always 6 elements -->
        </nav>
        <div class="search-bar">
                <input type="text" name="" id="">
                <input id="submit" type="submit" value="Submit">
            <button id="trending">See what's trending</button>
            <button id="emoted">Emoted</button>
        </div>
    </header>
    <main id="gifs-section" class="container">
        <!-- rendered gifs go here -->
        <!-- <div>
            <img src="" alt="">
            <div>Rating</div>
        </div> -->
    </main>
</body>
<script>
    class Config{
        constructor(){
            this.apiKey = "aFFKTuSMjd6j0wwjpFCPXZipQbcnw3vB"
            this.amount = 20;
            this.navTags = ['Internet Cats', 'Meme\'s', 'Typing', 'Space', 'Rick and Morty' ];
            this.emotes = ['Heart','Laugh','Amazed','Angry'];
            this.gifAPI = 'https://api.giphy.com/v1/gifs/';
            // this.savedAPI = '192.168.100.7:555/saveAPI/'
            this.apiTrending = 'https://api.giphy.com/v1/gifs/trending?limit=10&api_key=aFFKTuSMjd6j0wwjpFCPXZipQbcnw3vB&fmt=json'
            // this.InputData = gifList;
            this.emoted = {"data":{}}
        }
    }

    class Gallery extends Config {
        // appendNode(node,targetNode){
        //     targetNode.appendChild(node);
        // }

        async pullData(tabName){
            let response;
            let responseType;
            switch (tabName) {
                case "See what's trending":
                    console.log('pulling trending gifs')
                    response = await fetch(`${this.gifAPI}trending?limit=${this.amount}\&api_key=${this.apiKey}`);
                    break;
                case 'Emoted':
                    console.log('pulling emoted data')
                    // response = await fetch(this.savedApi...)
                    response = this.emoted;
                    responseType = 'emoted';
                    break;
                default:
                    console.log("pulling queried gifs");
                    response = await fetch(`${this.gifAPI}search?q=${tabName}\&limit=${this.amount}&api_key=${this.apiKey}`);
                    break;
            }
            {
            // if(tabName === "See what's trending"){
            //     console.log('pulling trending gifs')
            //     response = await fetch(`${this.gifAPI}trending?limit=${this.amount}\&api_key=${this.apiKey}`);
            // }else{
            //     console.log("pulling queried gifs");
            //     response = await fetch(`${this.gifAPI}search?q=${tabName}\&limit=${this.amount}&api_key=${this.apiKey}`);
            // }
            }
           
            document.getElementById('gifs-section').innerHTML = '';
            if(responseType === 'emoted'){
                return response;
            }else{
                return response.json();
            }

        }

        loadTags(){
            let navContainer = document.querySelector('.nav-tags')
            navContainer.innerHTML = '';

            this.navTags.forEach((item)=>{
                let tagNode = document.createElement('button');
                tagNode.innerText = item;
                tagNode.addEventListener('click', (event)=>{

                    this.pullData(event.target.innerText).then((result)=>{
                        this.renderGifs(result.data);
                    })
                })
                navContainer.appendChild(tagNode)
            })
        }
        updateTags(newTag){
            this.navTags.shift();
            this.navTags.push(newTag);
            this.loadTags();
        }
        createGifBox(gifLink, emoji){
            let gifBox = document.createElement('div');
            gifBox.className = "gif-box";

            let imgGIF = document.createElement('img')
            imgGIF.setAttribute('src',gifLink);

            let gifBar = document.createElement('div');
            gifBar.className = "gif-bar";
            let gifRating = document.createElement('div');
            gifRating.innerText = 'Rating';

            gifBar.appendChild(gifRating);
            gifBar.appendChild(this.createEmotes(emoji));

            gifBox.appendChild(imgGIF);
            gifBox.appendChild(gifBar);

        
            return gifBox
        }
        
        createEmotes(specificEmoji){
            let emotesWrapper = document.createElement('div');
            emotesWrapper.className = 'emotes-wrapper';
            if(specificEmoji != undefined){
                let emoji = document.createElement('img')
                emoji.setAttribute('src',`./Assets/${specificEmoji}.gif`);
                emotesWrapper.appendChild(emoji);
            }else{
                this.emotes.forEach((item)=>{
                    let emoji = document.createElement('img')
                    emoji.setAttribute('src',`./Assets/${item}.gif`);
                    emoji.addEventListener('click', (event)=>{
                        //fetch post should be done here, this time we save it locally 
                        //save emoted gif url and emoji clicked data:[{url:emoji}] because url is unique to gif
                        // this.emotedGifs.push({event.target})
                        console.log('saving gif');
                        let emojiPath = event.target.src.split('/');
                        let emoji = emojiPath[emojiPath.length-1].slice(0,-4);

                        let gifLink = event.target.parentElement.parentElement.parentElement.firstElementChild.src //$$
                        
                        this.emoted.data[gifLink] = emoji;
                        console.log(this.emoted);

                    })
                    emotesWrapper.appendChild(emoji);
                })
            }

            return emotesWrapper;
        }
        renderGifs(gifList,listType = 'normal'){
            console.log(gifList);
            let gifSection = document.getElementById('gifs-section')
            if(listType === 'emoted'){
                console.log('rendering emoted gifs');
                // console.log(gifList);   
                {
                /*
                gifList.forEach((item)=>{
                    // console.log(Object.keys(item));
                    // console.log(item[0]);
                    // const [key, value] = Object.entries(item);
                    // let key = Object.entries(item)[0];
                    // let value = Object.entries(item)[1];
                    console.log(item);
                    // gifSection.appendChild(this.createGifBox(key,value));
                })
                */
                }
                for (const [key, value] of Object.entries(gifList)) {
                    console.log(key);
                    console.log(value);
                    gifSection.appendChild(this.createGifBox(key,value));
                }
            }else{
                gifList.forEach((item)=>{
                    gifSection.appendChild(this.createGifBox(item.images.downsized.url));
                })
            }
            //create gif element from given json object
            //append them to container
        }
    }

    var gallery = new Gallery();
    gallery.loadTags();
    
    document.getElementById('trending').addEventListener('click' , (event)=>{
        gallery.pullData(event.target.innerText).then((result)=>{
            gallery.renderGifs(result.data);
        });
    })
    document.getElementById('emoted').addEventListener('click' , (event)=>{
        gallery.pullData(event.target.innerText).then((result)=>{
            gallery.renderGifs(result.data,'emoted');
        });
    })
    document.getElementById('submit').addEventListener('click', (event)=>{
        let inputValue = event.target.parentElement.firstElementChild.value
        gallery.pullData(inputValue).then((result)=>{
            gallery.renderGifs(result.data);
        })
        gallery.updateTags(inputValue);
        inputValue = '';
        
    })
    // on navTags click
    //   wipe out Gallery container 
    //   generate queryURL based on target.innerText and Config paremeters
    //   then fetch get all the data as array of objects
    //   and render them

    //on submit
    //  goes same, we just unshift first value in navTags array and push new one there

</script>
</html>